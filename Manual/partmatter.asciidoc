:toc:
[[chp:opalcycl]]

:stem: latexmath
:sectnums:

[[chp:partmatt]]
Physics Models Used in the Particle Matter Interaction Model
------------------------------------------------------------

The command to define the particle matter interacton is
PARTICLEMATTERINTERACTION.

MATERIAL::
  The material of the surface.
ENABLERUTHERFORD::
  Switch to disable Rutherford scattering, default true.

The so defined instance has then to be added to an element using the
attribute

[[the-energy-loss]]
The Energy Loss
~~~~~~~~~~~~~~~

The energy loss is simulated using the Bethe-Bloch equation.


[latexmath]
++++
-\frac{\mathrm{d} E}{\mathrm{d} x}=\frac{K z^2 Z}{A \beta^2}\left[\frac{1}{2} \ln{\frac{2 m_e c^2\beta^2 \gamma^2 Tmax}{I^2}}-\beta^2 \right],
++++


where latexmath:[Z] is the atomic number of absorber, latexmath:[A]
is the atomic mass of absorber, latexmath:[m_e] is the electron mass,
latexmath:[z] is the charge number of the incident particle,
latexmath:[K=4\pi N_Ar_e^2m_ec^2], latexmath:[r_e] is the classical
electron radius, latexmath:[N_A] is the Avogadro’s number,
latexmath:[I] is the mean excitation energy. latexmath:[\beta] and
latexmath:[\gamma] are kinematic variables. latexmath:[T_{max}] is
the maximum kinetic energy which can be imparted to a free electron in a
single collision.

[latexmath]
++++
T_{max}=\frac{2m_ec^2\beta^2\gamma^2}{1+2\gamma m_e/M+(m_e/M)^2},
++++

where latexmath:[M] is the incident particle mass.

The stopping power is compared with PSTAR program of NIST in
Figure 1.

.Figure 1 : The comparison of stopping power with PSTAR.
image:figures/partmatter/dEdx.png[width=500]

Energy straggling: For relatively thick absorbers such that the number
of collisions is large, the energy loss distribution is shown to be
Gaussian in form. For non-relativistic heavy particles the spread
latexmath:[\sigma_0] of the Gaussian distribution is calculated by:

[latexmath]
++++
\sigma_0^2=4\pi N_Ar_e^2(m_ec^2)^2\rho\frac{Z}{A}\Delta s,
++++

where latexmath:[\rho] is the density, latexmath:[\Delta s] is the
thickness.

[[the-coulomb-scattering]]
The Coulomb Scattering
~~~~~~~~~~~~~~~~~~~~~~

The Coulomb scattering is treated as two independent events: the
multiple Coulomb scattering and the large angle Rutherford scattering. +
Using the distribution given in Classical Electrodynamics, by J. D.
Jackson, the multiple- and single-scattering distributions can be
written: 

[latexmath]
++++
P_M(\alpha) \;\mathrm{d} \alpha=\frac{1}{\sqrt{\pi}}e^{-\alpha^2}\;\mathrm{d}\alpha,
++++

[latexmath]
++++
P_S(\alpha) \;\mathrm{d} \alpha=\frac{1}{8 \ln(204 Z^{-1/3})} \frac{1}{\alpha^3}\;\mathrm{d}\alpha,
++++

where
latexmath:[\alpha=\frac{\theta}{<\Theta^2>^{1/2}}=\frac{\theta}{\sqrt 2 \theta_0}].

The transition point is
latexmath:[\theta=2.5 \sqrt 2 \theta_0\approx3.5 \theta_0],

[latexmath]
++++
\theta_0=\frac{{13.6}{MeV}}{\beta c p} z \sqrt{\Delta s/X_0} [1+0.038 \ln(\Delta s/X_0)],
++++

where latexmath:[p] is the momentum, latexmath:[\Delta s] is the
step size, and latexmath:[X_0] is the radiation length.

[[multiple-coulomb-scattering]]
Multiple Coulomb Scattering
^^^^^^^^^^^^^^^^^^^^^^^^^^^

Generate two independent Gaussian random variables with mean zero and
variance one: latexmath:[z_1] and latexmath:[z_2]. If
latexmath:[z_2 \theta_0>3.5 \theta_0], start over. Otherwise,

[latexmath]
++++
x=x+\Delta s p_x+z_1 \Delta s \theta_0/\sqrt{12}+z_2 \Delta s \theta_0/2,
++++

[latexmath]
++++
p_x=p_x+z_2 \theta_0.
++++

Generate two independent Gaussian random
variables with mean zero and variance one: latexmath:[z_3] and
latexmath:[z_4]. If latexmath:[z_4 \theta_0>3.5 \theta_0], start
over. Otherwise, 

[latexmath]
++++
y=y+\Delta s p_y+z_3 \Delta s \theta_0/\sqrt{12}+z_4 \Delta s \theta_0/2,
++++


[latexmath]
++++
p_y=p_y+z_4 \theta_0.
++++

[[large-angle-rutherford-scattering]]
Large Angle Rutherford Scattering
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^

Generate a random number latexmath:[\xi_1], _if_
latexmath:[\xi_1 < \frac{\int_{2.5}^\infty P_S(\alpha)d\alpha}{\int_{0}^{2.5} P_M(\alpha)\;\mathrm{d}\alpha+\int_{2.5}^\infty P_S(\alpha)\;\mathrm{d}\alpha}=0.0047],
sampling the large angle Rutherford scattering.

The cumulative distribution function of the large angle Rutherford
scattering is 

[latexmath]
++++
F(\alpha)=\frac{\int_{2.5}^\alpha P_S(\alpha) \;\mathrm{d} \alpha}{\int_{2.5}^\infty P_S(\alpha) \;\mathrm{d} \alpha}=\xi,
++++

where latexmath:[\xi] is a random variable. So

[latexmath]
++++
\alpha=\pm 2.5 \sqrt{\frac{1}{1-\xi}}=\pm 2.5 \sqrt{\frac{1}{\xi}}.
++++

Generate a random variable latexmath:[P_3], +
_if_ latexmath:[P_3>0.5]

[latexmath]
++++
\theta_{Ru}=2.5 \sqrt{\frac{1}{\xi}} \sqrt{2}\theta_0,
++++

_else_

[latexmath]
++++
\theta_{Ru}=-2.5 \sqrt{\frac{1}{\xi}} \sqrt{2}\theta_0.
++++


The angle distribution after Coulomb scattering is shown in
Figure 2. The line is from Jackson’s formula, and the points are
simulations with Matlab. For a thickness of latexmath:[\Delta s=1e-4]
latexmath:[m], latexmath:[\theta=0.5349 \alpha] (in degree).

.Figure 2: The comparison of Coulomb scattering with Jackson’s book.
image:figures/partmatter/10steps.png[]

[[the-flow-diagram-of-collimatorphysics-class-in-opal]]
The Flow Diagram of _CollimatorPhysics_ Class in OPAL
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

.Figure 3: The diagram of CollimatorPhysics in _OPAL_.
image:figures/partmatter/diagram.png[]

.Figure 4: The diagram of CollimatorPhysics in _OPAL_ (continued). 
image:figures/partmatter/Diagram2.png[]

[[the-substeps]]
The Substeps
^^^^^^^^^^^^

Small step is needed in the routine of CollimatorPhysics.

If a large step is given in the main input file, in the file
_CollimatorPhysics.cpp_, it is divided by a integer number
latexmath:[n] to make the step size using for the calculation of
collimator physics less than 1.01e-12 s. As shown by
Figures 3 and 4 in the previous section, first we track one
step for the particles already in the collimator and the newcomers, then
another (n-1) steps to make sure the particles in the collimator
experience the same time as the ones in the main bunch.

Now, if the particle leave the collimator during the (n-1) steps, we
track it as in a drift and put it back to the main bunch when finishing
(n-1) steps.

[[available-materials-in-opal]]
Available Materials in _OPAL_
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

.List of materials with their parameters implemented in _OPAL_.
[cols="^,^,^,^,^,^,^,^,^,^",options="header",]
|=======================================================================
|Material |Z |A |latexmath:[\rho] [latexmath:[g/cm^3]] |X0
[latexmath:[g/cm^2]] |A2 |A3 |A4 |A5 |_OPAL_ Name
|Aluminum |13 |26.98 |2.7 |24.01 |4.739 |2766 |164.5 |2.023E-02
|`Aluminum`

|AluminaAl2O3 |50 |101.96 |3.97 |27.94 |7.227 |11210 |386.4 |4.474e-3
|`AluminaAl2O3`

|Copper |29 |63.54 |8.96 |12.86 |4.194 |4649 |81.13 |2.242E-02 |`Copper`

|Graphite |6 |12.0172 |2.210 |42.7 |2.601 |1701 |1279 |1.638E-02
|`Graphite`

|GraphiteR6710 |6 |12.0172 |1.88 |42.7 |2.601 |1701 |1279 |1.638E-02
|`GraphiteR6710`

|Titan |22 |47.8 |4.54 |16.16 |5.489 |5260 |651.1 |8.930E-03 |`Titan`

|Air |7 |14 |0.0012 |37.99 |3.350 |1683 |1900 |2.513E-02 |`Air`

|Kapton |6 |12 |1.4 |39.95 |2.601 |1701 |1279 |1.638E-02 |`Kapton`

|Gold |79 |197 |19.3 |6.46 |5.458 |7852 |975.8 |2.077E-02 |`Gold`

|Water |10 |18 |1 |36.08 |2.199 |2393 |2699 |1.568E-02 |`Water`

|Mylar |6.702 |12.88 |1.4 |39.95 |3.35 |1683 |1900 |2.513E-02 |`Mylar`

|Berilium |4 |9.012 |1.848 |65.19 |2.590 |966.0 |153.8 |3.475E-02
|`Berilium`

|Molybdenum |42 |95.94 |10.22 |9.8 |7.248 |9545 |480.2 |5.376E-03
|`Molybdenum`
|=======================================================================

[[example-of-an-input-file]]
Example of an Input File
~~~~~~~~~~~~~~~~~~~~~~~~

link:examples/particlematterinteraction.in[]

FX5 is a slit in x direction, the `APERTURE` is *POSITIVE*, the first
value in `APERTURE` is the left part, the second value is the right
part. FX16 is a slit in y direction, the `APERTURE` is *NEGATIVE*, the
first value in `APERTURE` is the down part, the second value is the up
part.

[[a-simple-test]]
A Simple Test
~~~~~~~~~~~~~

A cold Gaussian beam with latexmath:[\sigma_x=\sigma_y=5] mm. The
position of the collimator is from 0.01 m to 0.1 m, the half aperture in
y direction is latexmath:[3] mm. Figure 5 shows the
trajectory of particles which are either absorbed or deflected by a
copper slit. As a benchmark of the collimator model in _OPAL_,
Figure 6 shows the energy spectrum and angle deviation at
z=0.1 m after an elliptic collimator.

.Figure 5: The passage of protons through the collimator.
image:figures/partmatter/longcoll6.png[]

.Figure 6: The energy spectrum and scattering angle at z=0.1 m
image:figures/partmatter/spectandscatter.png[]
